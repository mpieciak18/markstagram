// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())

  email    String  @unique @db.VarChar(254)
  username String  @unique @db.VarChar(15)
  password String  @db.VarChar(60)
  name     String  @db.VarChar(30)
  bio      String? @db.VarChar(160)
  image    String?

  posts           Post[]
  comments        Comment[]
  likes           Like[]
  saves           Save[]
  conversations   Conversation[]
  messages        Message[]
  givenFollows    Follow[]       @relation("givenFollows")
  receivedFollows Follow[]       @relation("receivedFollows")
  givenNotifs     Notification[] @relation("givenNotifications")
  receivedNotifs  Notification[] @relation("receivedNotifications")
}

model Follow {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())

  giverId    Int
  giver      User @relation("givenFollows", fields: [giverId], references: [id], onDelete: Cascade)
  receiverId Int
  receiver   User @relation("receivedFollows", fields: [receiverId], references: [id], onDelete: Cascade)

  @@unique([giverId, receiverId])
}

model Post {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())

  image   String @unique
  caption String @db.VarChar(2200)

  userId   Int
  user     User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  comments Comment[]
  likes    Like[]
  saves    Save[]
}

model Comment {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())

  message String @db.VarChar(2200)

  userId Int
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)
  postId Int
  post   Post @relation(fields: [postId], references: [id], onDelete: Cascade)
}

model Like {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())

  userId Int
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)
  postId Int
  post   Post @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@unique([userId, postId])
}

model Save {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())

  userId Int
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)
  postId Int
  post   Post @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@unique([userId, postId])
}

model Conversation {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())

  users    User[]
  messages Message[]
}

model Message {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())

  message   String @db.VarChar(2000)

  senderId       Int
  sender         User         @relation(fields: [senderId], references: [id], onDelete: Cascade)
  conversationId Int
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
}

model Notification {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())

  userId Int
  user   User @relation("receivedNotifications", fields: [userId], references: [id], onDelete: Cascade)

  otherUserId Int
  otherUser   User @relation("givenNotifications", fields: [otherUserId], references: [id], onDelete: Cascade)

  // Pseudo-relational, optional field for post id
  postId Int?

  type    String @db.VarChar(30)
  read    Boolean
}
